<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="productDAO">
	 
	 
	<select id="getCateProdList" parameterType="com.flower.vo.ProductVO" resultType="com.flower.vo.ProductVO">
		SELECT p.PRODUCT_ID, p.PRODUCT_NAME, p.PRODUCT_PRICE, group_concat(img.PRODUCT_IMAGE_FILE_NAME ORDER BY img.PRODUCT_IMAGE_FILE_NAME) product_image_file_name
		FROM product p INNER JOIN product_image img
		ON p.product_id = img.product_id
		WHERE img.PRODUCT_IMAGE_FROUTE = 'list'
		<if test="blooming_season != null">
			AND p.BLOOMING_SEASON = #{blooming_season}
		</if>
		<if test="pet_friendly == true">
			AND p.PET_FRIENDLY = #{pet_friendly}
		</if>
		<if test="easy_care == true">
			AND p.EASY_CARE = #{easy_care}
		</if>
		<if test="blooming_time != null">
			AND p.BLOOMING_TIME = #{blooming_time}
		</if>
		GROUP BY p.PRODUCT_ID;
	</select>
	
	<select id="test" parameterType="com.flower.vo.ProductVO" resultType="com.flower.vo.ProductVO">
		select img.PRODUCT_ID,  img.product_image_file_name
		from flower.product p inner join flower.product_image img
		on p.product_id = img.product_id
		where p.blooming_season = #{blooming_season}
		and img.product_image_type = 'list'
		ORDER BY PRODUCT_ID;
	</select>
	
	<select id="getProd" parameterType="com.flower.vo.ProductVO" resultType="com.flower.vo.ProductVO">
		SELECT p.PRODUCT_ID, p.PRODUCT_NAME, p.PRODUCT_PRICE, p.BLOOMING_SEASON, p.PET_FRIENDLY, p.EASY_CARE, p.PRODUCT_LIGHT, p.BLOOMING_TIME, group_concat(img.PRODUCT_IMAGE_FILE_NAME ORDER BY img.PRODUCT_IMAGE_FILE_NAME) product_image_file_name, group_concat(img.PRODUCT_IMAGE_TYPE ORDER BY img.PRODUCT_IMAGE_TYPE) product_image_type, group_concat(img.PRODUCT_IMAGE_FROUTE ORDER BY img.PRODUCT_IMAGE_FILE_NAME) product_image_froute
		FROM flower.product p INNER JOIN flower.product_image img
		on p.product_id = img.product_id
		WHERE p.PRODUCT_ID = #{product_id}
		AND img.PRODUCT_IMAGE_FROUTE != 'list'
		GROUP BY p.PRODUCT_ID
	</select>
	
	<select id="getImgMain" parameterType="com.flower.vo.ProductVO" resultType="com.flower.vo.ProductVO">
		SELECT img.PRODUCT_IMAGE_FILE_NAME
		FROM product_image img
		WHERE product_id = #{product_id}
		AND PRODUCT_IMAGE_FROUTE = 'main'
	</select>
	
	<select id="getImgSub" parameterType="com.flower.vo.ProductVO" resultType="com.flower.vo.ProductVO">
		SELECT group_concat(img.PRODUCT_IMAGE_FILE_NAME ORDER BY img.PRODUCT_IMAGE_FILE_NAME) PRODUCT_IMAGE_FILE_NAME
		FROM product_image img
		WHERE product_id = #{product_id}
		AND PRODUCT_IMAGE_FROUTE = 'sub'
		GROUP BY img.product_id
	</select>
	
	<select id="getImgGuide" parameterType="com.flower.vo.ProductVO" resultType="com.flower.vo.ProductVO">
		SELECT group_concat(img.PRODUCT_IMAGE_FILE_NAME ORDER BY img.PRODUCT_IMAGE_FILE_NAME) PRODUCT_IMAGE_FILE_NAME
		FROM product_image img
		WHERE product_id = #{product_id}
		AND PRODUCT_IMAGE_FROUTE = 'guide'
		GROUP BY img.product_id
	</select>
	
	<!-- 상품필터링 -->
	<select id="filterProducts" resultType="com.flower.vo.ProductVO" parameterType="java.util.Map">
        SELECT * FROM product
        <where>
            <if test="pet_friendly != null">
                AND pet_friendly = #{pet_friendly}
            </if>
            <if test="easy_care != null">
                AND easy_care = #{easy_care}
            </if>
            <!-- 라디오 버튼의 경우도 추가 가능 -->
           
        
        </where>
    </select>
	
	
	
</mapper>
